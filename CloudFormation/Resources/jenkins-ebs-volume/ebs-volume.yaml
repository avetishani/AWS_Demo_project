AWSTemplateFormatVersion: '2010-09-09'
Parameters:
  Size:
    Type: Number
    Description: Size of volume in GB
    Default: 8

Resources:
  EBSVolume:
    Type: AWS::EC2::Volume
    Properties:
      AvailabilityZone: us-east-1a
      Encrypted: No
      Size: !Ref Size
      Tags:
        - 
          Key: "service"
          Value: "jenkins"
      VolumeType: gp2

  BasicLifecyclePolicy:
    Type: "AWS::DLM::LifecyclePolicy"
    Properties:
      Description: "Lifecycle Policy for Jenkins"
      State: "ENABLED"
      PolicyDetails:
        ResourceTypes:
          - "VOLUME"

        Schedules:
          -
            Name: "Daily Snapshots"
            TagsToAdd:
              -
                Key: "type"
                Value: "DailySnapshot"

            CreateRule:
              Interval: 24
              IntervalUnit: "HOURS"
              Times:
                - "01:00"
            RetainRule:
              Count: 5
            CopyTags: true